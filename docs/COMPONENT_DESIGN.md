# 组件设计思想（从使用者出发）

目标：让使用者“拿来即用、心智零负担、扩展不设限”。所有 API 与实现都围绕这三点持续减法。

## 设计总纲
- 最小可用：一行代码可完成典型使用，无需样板或额外依赖。
- 渐进增强：默认足够好；需要时再层层暴露进阶能力（样式、环境、协议、回调）。
- 一致命名：与 SwiftUI 生态一致（View 命名为名词，样式以 `Style` 结尾，配置以 `Configuration` 命名）。
- 值语义优先：输入尽量为值类型，副作用隔离在可注入边界（如 `ObservableObject`）。
- 失败安全：容错不崩溃，必要时 `assert`/日志提示开发者，面向用户的失败默认降级显示。
- 文档先行：公开 API 均有文档注释与最小示例；示例 App 提供“可复制黏贴”的片段。

## 使用者视角的 API 形态
- 单一职责构造：
  - 默认构造函数覆盖 80% 场景；
  - 额外能力通过可选参数或修饰器（Modifier）逐步开启；
  - 谨慎增加枚举与协议泛型，保证调用点易读。
- 风格与主题：
  - 提供 `EnvironmentKey`/`ViewModifier` 驱动的主题能力；
  - 暴露 `*Style` 协议以供彻底自定义；默认实现质量高且通用。
- 交互与状态：
  - 可交互组件以 `Binding<Value>` 输入；
  - 只在必要时引入 `@StateObject` 管理内部控制器，并通过 `@MainActor` 保证线程安全。
- 逃生舱：
  - 预留 `content` 闭包、`background`/`overlay` 等挂点；
  - 保留 `View` 合成自由，不锁死布局。

## 示例优先与可测试性
- 示例优先：每个组件配 1 个极简示例 + 1 个进阶示例；示例 App 中可直接跑通。
- 测试友好：
  - 计算与映射逻辑抽成纯函数（易测、可基准），
  - 关键元素设置稳定的 `accessibilityIdentifier`；
  - UI 测试专注“可见性与交互达成”。

## 性能与可达性
- 默认廉价：避免在 `body` 中创建重型对象；对高频绘制视图使用 `Canvas`/`CGPath` 等批量绘制。
- 受控刷新：按需刷新（`TimelineView`、分段重绘、下采样）。
- 可达性：支持 Dynamic Type、颜色对比；交互元素具备合理的 `hitTest` 范围与语义标签。

## 破坏性变更与版本
- 遵循 SemVer，破坏性变更先经弃用周期，并在示例与说明中给出迁移路径。

## 评审核对清单（Checklist）
- 是否一行代码可完成典型用例？
- 默认值是否“看起来就对”？
- API 命名是否与 SwiftUI 一致且可预期？
- 复杂选项是否通过修饰器/样式渐进暴露？
- 是否提供逃生舱避免被设计锁死？
- 是否具备可测试的纯函数边界？
- 是否覆盖动态字体/深色模式/本地化？
- 是否有示例与文档注释？

---

示例（极简心智）：

```swift
// 默认即可用，支持主题与进阶样式扩展
WaveformView(audioURL: url)
    .waveformStyle(.bars)
    .tint(.blue)
```
